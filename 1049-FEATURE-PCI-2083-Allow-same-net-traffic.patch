From 9c1a9d6537466202897341eb9cfdc0a0bb656562 Mon Sep 17 00:00:00 2001
From: Martin Surovcak <martin.surovcak@gooddata.com>
Date: Tue, 3 Sep 2013 11:32:09 +0200
Subject: [PATCH] FEATURE: PCI-2083 Do not generate per-instance rules when
 allow_same_net_traffic=True

---
 nova/virt/firewall.py |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/nova/virt/firewall.py b/nova/virt/firewall.py
index 6db5b7e..272e4ce 100644
--- a/nova/virt/firewall.py
+++ b/nova/virt/firewall.py
@@ -401,7 +401,7 @@ class IptablesFirewallDriver(FirewallDriver):
                     LOG.debug('Using cidr %r', rule.cidr, instance=instance)
                     args += ['-s', rule.cidr]
                     fw_rules += [' '.join(args)]
-                else:
+                elif not FLAGS.allow_same_net_traffic:
                     if rule['grantee_group']:
                         for instance in rule['grantee_group']['instances']:
                             try:
-- 
1.7.10.2 (Apple Git-33)

