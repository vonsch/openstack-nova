From 5d63601a8cd79d7d3311b32f6fe8c30fb2ec4580 Mon Sep 17 00:00:00 2001
From: Takaaki Suzuki <suzuki@midokura.com>
Date: Wed, 8 Aug 2012 11:21:55 +0900
Subject: [PATCH 06/10] Add error log for live migration.

Fixes bug: 917615
Change-Id: I740c0def3b1f759aec3d4ae5fe3264484c704807
Cherry-picked: adb98d50d2af36fc6215cbec63fe89e3e67d8fa2
Signed-off-by: Takaaki Suzuki <suzuki@midokura.com>
---
 Authors                         | 1 +
 nova/virt/libvirt/connection.py | 4 +++-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/Authors b/Authors
index 4d784ca..1c45f42 100644
--- a/Authors
+++ b/Authors
@@ -184,6 +184,7 @@ Soren Hansen <soren.hansen@rackspace.com>
 Stanislaw Pitucha <stanislaw.pitucha@hp.com>
 Stephanie Reese <reese.sm@gmail.com>
 Sumit Naiksatam <snaiksat@cisco.com>
+Takaaki Suzuki <suzuki@midokura.com>
 Thierry Carrez <thierry@openstack.org>
 Tim Simpson <tim.simpson@rackspace.com>
 Todd Willey <todd@ansolabs.com>
diff --git a/nova/virt/libvirt/connection.py b/nova/virt/libvirt/connection.py
index 24112da..16b1bb1 100644
--- a/nova/virt/libvirt/connection.py
+++ b/nova/virt/libvirt/connection.py
@@ -2103,8 +2103,10 @@ class LibvirtConnection(driver.ComputeDriver):
                              None,
                              FLAGS.live_migration_bandwidth)
 
-        except Exception:
+        except Exception as e:
             with utils.save_and_reraise_exception():
+                LOG.error(_("Live Migration failure: %(e)s") % locals(),
+                          instance=instance_ref)
                 recover_method(ctxt, instance_ref, dest, block_migration)
 
         # Waiting for completion of live_migration.
-- 
1.7.11.4

